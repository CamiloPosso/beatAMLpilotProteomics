---
title: "Figure 1 Data Summary"
author: "Sara Gosline"
date: "03/30/2021"
output: html_document
---

## Get Data
This calls the standard data loading function that exists at `../beatAMLdata.R`. Once it is loaded it should not have to be reloaded. 

```{r setup, include=FALSE,message=FALSE}
if(!require(amlresistancenetworks)){
require(devtools)
devtools::install_github('sgosline/amlresistancenetworks')
require(amlresistancenetworks)
}

knitr::opts_chunk$set(echo = FALSE, warning=FALSE)


if(!exists('dataLoaded')){
  source("../beatAMLdata.R")
  loadBeatAMLData()
    dataLoaded=TRUE
}

```

## Data Summary

The goal fo this markdown is to summarize the BeatAML data that we have so far. Patient summary, summary of AUC value, and general proteomics/protein data. Here we have the data for

```{r patient cohort, message=FALSE}
  res<-auc.dat%>%select(-c('FLT3-ITD','FLT3-MUT','NPM1'))%>%
    plotAllAUCs(.,pat.data,drug.metric='AUC',drug.column='Condition')

  full.drg<-res%>%
      tibble::rownames_to_column("AML sample")%>%
      left_join(auc.dat)%>%
      select(`AML sample`,Drug='Condition',proteins,RNA,mutations)%>%
    distinct()%>%
    group_by(Drug)%>%
    summarize(`Patients with proteomics`=length(which(proteins==TRUE)),`Patients with mRNA`=length(which(RNA==TRUE)),`Patients with Mutations`=length(which(mutations==TRUE)))
  
  knitr::kable(full.drg)
  write.csv(full.drg,'table1.csv')
  write.csv(res,'supp_table1.csv')
  
```

Since many of the patients are incomplete, we save a second version of the data that has only those 'complete' datasets.

```{r full patients}


red.auc<-auc.dat%>%subset(`AML sample`%in%full.pats$`AML sample`)
red.dat<-pat.data%>%subset(`AML sample`%in%full.pats$`AML sample`)
red.phos<-pat.phos%>%subset(Sample%in%full.pats$`AML sample`)

knitr::kable(res[full.pats$`AML sample`,])
```

## Drug Family summary

We can also collate information by drug family to increase power. 


```{r drug family, message=FALSE}
  res<-auc.dat.fam%>%select(-c('FLT3-ITD','FLT3-MUT','NPM1'))%>%
    plotAllAUCs(.,pat.data,drug.metric='AUC',drug.column='family')

  full.drg<-res%>%
      tibble::rownames_to_column("AML sample")%>%
      left_join(auc.dat.fam)%>%
      select(`AML sample`,Drug='family',proteins,RNA,mutations)%>%
    distinct()%>%
    group_by(Drug)%>%
    summarize(`Patients with proteomics`=length(which(proteins==TRUE)),`Patients with mRNA`=length(which(RNA==TRUE)),`Patients with Mutations`=length(which(mutations==TRUE)))
  
  knitr::kable(full.drg)
  write.csv(full.drg,'fam_table1.csv')
  write.csv(res,'fam_supp_table1.csv')

```

## Data correlations

TODO: We need to create a  figure that describes how the data correlates across modalities. 